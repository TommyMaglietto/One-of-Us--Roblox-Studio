-- ServerScriptService/PromptSeeder.server.lua
-- Adds Collect prompts to planks under workspace.Planks
-- Adds Place prompts to bridge placeholders under workspace.AOI.Bridge.Placeholders

local WK = workspace
local AOI = WK:WaitForChild("AOI")
local BRIDGE = AOI:WaitForChild("Bridge")
local PLACEHOLDERS = BRIDGE:WaitForChild("Placeholders")
local PLANKS = WK:WaitForChild("Planks")

local PICKUP_MAX_DIST = 35
local PLACE_MAX_DIST  = 40

local function hostPart(inst)
	if inst:IsA("BasePart") then return inst end
	if inst:IsA("Model") then
		if inst.PrimaryPart then return inst.PrimaryPart end
		for _, d in ipairs(inst:GetDescendants()) do
			if d:IsA("BasePart") then return d end
		end
	end
end

local function seedPickup(inst)
	if not inst:IsDescendantOf(PLANKS) then return end
	if inst.Name ~= "Plank" then return end
	if not (inst:IsA("BasePart") or inst:IsA("Model")) then return end
	local host = hostPart(inst); if not host then return end
	if host:FindFirstChild("PickUpPlank") then return end

	local pp = Instance.new("ProximityPrompt")
	pp.Name = "PickUpPlank"
	pp.ActionText = "Collect"
	pp.ObjectText = "Plank"
	pp.KeyboardKeyCode = Enum.KeyCode.E
	pp.GamepadKeyCode  = Enum.KeyCode.ButtonX
	pp.ClickablePrompt = true
	pp.HoldDuration = 0.5
	pp.RequiresLineOfSight = false
	pp.MaxActivationDistance = PICKUP_MAX_DIST
	pp.Parent = host
end

local function seedPlace(inst)
	if not inst:IsDescendantOf(PLACEHOLDERS) then return end
	local host = hostPart(inst); if not host then return end

	host.Name = "PlankPlaceholder"
	host.Anchored = true
	host.CanCollide = false
	host.Transparency = 1

	if not host:FindFirstChild("Occupied") then
		local b = Instance.new("BoolValue"); b.Name = "Occupied"; b.Value = false; b.Parent = host
	end
	if not host:FindFirstChild("Snap") then
		local a = Instance.new("Attachment"); a.Name = "Snap"; a.Parent = host
	end
	if not host:FindFirstChild("PlacePlankHere") then
		local pp = Instance.new("ProximityPrompt")
		pp.Name = "PlacePlankHere"
		pp.ActionText = "Place"
		pp.ObjectText = "Bridge Slot"
		pp.KeyboardKeyCode = Enum.KeyCode.E
		pp.GamepadKeyCode  = Enum.KeyCode.ButtonA
		pp.ClickablePrompt = true
		pp.HoldDuration = 0.5
		pp.RequiresLineOfSight = false
		pp.MaxActivationDistance = PLACE_MAX_DIST
		pp.Parent = host
	end
end

for _, d in ipairs(PLANKS:GetDescendants()) do seedPickup(d) end
for _, d in ipairs(PLACEHOLDERS:GetDescendants()) do seedPlace(d) end
PLANKS.DescendantAdded:Connect(function(d) task.defer(function() seedPickup(d) end) end)
PLACEHOLDERS.DescendantAdded:Connect(function(d) task.defer(function() seedPlace(d) end) end)
